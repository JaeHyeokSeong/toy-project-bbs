<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org"
      th:replace="~{ layout/basicLayout :: basicLayout (~{::title}, ~{::link}, ~{::script}, ~{::section})}">
<head>
    <meta charset="UTF-8">
    <title th:text="|${boardDto.title} - 자유게시판|">자유게시판 - 게시물 보기</title>
    <link rel="stylesheet" href="/css/board.css">
    <script type="text/javascript" src="/js/board.js"></script>
</head>
<body>

<!--<section class="container board-view my-5">-->
<section class="post-header my-5">

    <h5>
        <span id="go-list" style="cursor: pointer">
            <i class="bi bi-arrow-left h4"></i> 목록
        </span>
    </h5>

    <!-- 제목 -->
    <h2 class="post-title mt-4" th:text="${boardDto.title}">게시물 제목</h2>

    <!-- 메타 정보 -->
    <div class="post-meta mt-3">

        <!-- 등록자 -->
        <span class="meta-item meta-writer"
              th:text="${boardDto.name}">
        </span>

        <span class="meta-separator">·</span>

        <!-- 등록일 -->
        <span class="meta-item meta-date"
              th:text="${#temporals.format(boardDto.createdDate, 'yyyy.MM.dd HH:mm:ss')} + ' 작성' +
               ${boardDto.createdDate != boardDto.lastModifiedDate ? ' (수정됨)' : ''}">
        </span>

        <span class="meta-separator">·</span>

        <!-- 조회수 -->
        <span class="meta-item meta-views">
            <i class="bi bi-eye"></i>
        <span th:text="${boardDto.views}"></span>
    </span>
    </div>

    <hr th:if="${boardDto.uploadedFiles.size() > 0}">

    <div class="uploaded-files mt-3" th:if="${boardDto.uploadedFiles.size() > 0}">
        <h6><i class="bi bi-file-earmark-arrow-down"></i> 첨부파일 (총 [[${boardDto.uploadedFiles.size()}]]개)</h6>
        <ul>
            <li th:each="attachedFile : ${boardDto.uploadedFiles}">
                <div class="thumb-wrapper">
                    <img
                            th:src="|/api/images/${attachedFile.storeFileName}|"
                            th:alt="${attachedFile.originalFileName}"
                            class="thumb-img"
                    >
                    <a
                            th:text="|[${attachedFileStat.count}] ${attachedFile.getOriginalFileName()}|"
                            th:href="|/api/files/${attachedFile.getStoreFileName()}|"
                            class="download-link"
                    ></a>
                </div>
            </li>
        </ul>
    </div>

    <hr>

    <div class="d-flex align-items-start mt-4 mb-3">
        <div id="board-id" hidden th:text="${boardDto.id}"></div>
        <!-- 좋아요 싫어요 버튼 및 갯수 -->
        <div th:if="${session.memberId == null}" class="action-buttons d-flex flex-column align-items-center me-4">
            <button class="btn" th:onclick="|alert('로그인이 필요합니다.');|">
                <i class="bi bi-hand-thumbs-up"></i>
            </button>
            <p th:text="${boardDto.totalReactionCount}">0</p>
            <button class="btn" th:onclick="|alert('로그인이 필요합니다.');|">
                <i class="bi bi-hand-thumbs-down"></i>
            </button>
        </div>
        <div th:if="${session.memberId != null}" class="action-buttons d-flex flex-column align-items-center me-4">
            <button class="btn" id="thumbs-up">
                <i id="thumbs-up-class" th:class="${boardDto.reactionType?.name()} == 'LIKE'
                 ? 'bi bi-hand-thumbs-up-fill' : 'bi bi-hand-thumbs-up'"></i>
            </button>
            <p id="total-reaction-ct" th:text="${boardDto.totalReactionCount}">0</p>
            <button class="btn" id="thumbs-down">
                <i id="thumbs-down-class" th:class="${boardDto.reactionType?.name()} == 'DISLIKE'
                 ? 'bi bi-hand-thumbs-down-fill' : 'bi bi-hand-thumbs-down'"></i>
            </button>
        </div>
        <!-- 본문 영역 -->
        <div class="content flex-grow-1" th:text="${boardDto.content}">
            본문 내용이 여기에 표시됩니다.
        </div>
    </div>

    <hr>

    <!-- 수정/삭제 -->
    <div class="d-flex justify-content-end gap-2 mt-4">
        <a th:href="@{/bbs/edit/{id}(id=${boardDto.id})}"
           class="btn btn-secondary"
           th:if="${session.memberId} == ${boardDto.memberId}"
        >
            수정
        </a>

        <form th:if="${session.memberId} == ${boardDto.memberId}"
              th:action="@{/bbs/delete/{id}(id=${boardDto.id})}"
              method="post">
            <button type="submit" id="delete-btn" class="btn btn-warning">
                삭제
            </button>
        </form>
    </div>

    <!-- 답변 -->
    <div>
        <!-- 총 답변 수 & 정렬 기준 -->
        <div class="comment-toolbar mt-4 mb-3">
            <p id="comment-count"></p>
            <select id="search-sort">
                <option th:each="cs : ${commentSearchSorts}"
                        th:value="${cs}" th:text="${cs.description}"></option>
            </select>
        </div>

        <!-- 답변 등록 -->
        <div class="add-comment-parent mb-4">
        <textarea id="add-comment-parent"
                  class="add-comment-input"
                  rows="1"
                  th:placeholder="${session.memberId} != null
                      ? ${memberName} + '님, 답변을 작성해보세요.' : '로그인 후 답변을 작성해 주세요.'"
                  th:disabled="${session.memberId == null}"
        ></textarea>
            <button id="submit-comment-parent" class="reply-btn" style="display: none;">답변 등록</button>
            <button id="cancel-comment-parent" class="cancel-btn" style="display: none;">취소</button>
            <!-- 인라인 스타일로 폭·여백만 재정의 -->
            <div id="submit-spinner"
                 class="spinner"
                 style="display: none; margin-left: 8px; width: 24px; height: 24px;">
            </div>
        </div>

        <!-- 답변 조회하기 -->
        <div class="mt-4">
            <div id="comments-container" class="comments-container"></div>
            <!-- 로딩 스피너 -->
            <div id="loading-spinner" class="spinner" style="display: none;"></div>
        </div>
    </div>

</section>

</body>
</html>